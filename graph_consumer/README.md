# Graph-Based Unsupervised Anomaly Detection for Network Data

This project implements a graph neural network (GNN) autoencoder for unsupervised anomaly detection in network data. It processes raw network data (assumed to be generated by a separate C++ script), constructs graph representations, learns normal network patterns, and identifies anomalies based on reconstruction errors.


## Installation

1.  **Create a virtual environment** (recommended):
    ```bash
    python -m venv .venv
    source .venv/bin/activate  # On Linux/macOS
    # .venv\Scripts\activate  # On Windows
    ```

2.  **Install required dependencies:**
    ```bash
    pip install torch torch-geometric networkx numpy scikit-learn matplotlib seaborn
    ```

## Usage

The `main.py` script is the entry point for the anomaly detection pipeline. **All configuration parameters can be specified via command-line arguments.**

The script will continuously monitor the `target_directory` for new data files, process them, update the GNN model online, detect anomalies, and log the results in the `anomaly_logs` directory. If visualization is enabled, node embeddings and node and egde features distributions will be periodically saved as PNG images in the `embeddings` directory.


To see the available command-line arguments and their descriptions, run:

```bash
python main.py --help
```

### Basic Usage Example:

To run the pipeline with default settings, simply execute:

```bash
python main.py --path <path_to_graph>
```

### Specifying Configuration via Command Line:

You can override the default configuration by providing command-line arguments. Here is a list of the available parameters:

- **`--path` / `-p` (required):**  
  Path to the directory to monitor for `.dot` graph files (e.g., `samples/big_web_enum`).

- **`--log_level` / `-l` (optional):**  
  Set the logging level (`DEBUG`, `INFO`, `WARNING`, `ERROR`, `CRITICAL`).  
  **Default:** `INFO`.

- **`--log_path` (optional):**  
  Path to save the application log file.  
  If not specified, logs will only be printed to the console.

- **`--log_max_bytes` (optional):**  
  Maximum size of the application log file before it rolls over (in bytes).  
  **Default:** `10485760` (10 MB).

- **`--log_backup_count` (optional):**  
  Number of backup application log files to keep.  
  **Default:** `5`.

- **`--model_path` (optional):**  
  Path to save the model checkpoints.  
  **Default:** `model_checkpoints`.

- **`--stats_path` (optional):**  
  Path to save training statistics.  
  **Default:** `stats`.

- **`--anomaly_path` (optional):**  
  Path to save anomaly logs.  
  **Default:** `anomaly_logs`.


## Understanding the Output
### Anomaly Logs (anomaly_logs/)
Anomaly detection results are saved in JSON files. Each file contains:
- **`timestamp`:**  
  The time when the anomalies were detected.

- **`update_count`:**  
  The number of data files processed up to this point.

- **`node_anomalies`:**  
  A list of detected anomalous nodes, with details including:
  - **`node_id`:** Internal index of the anomalous node in the graph.
  - **`ip`:** IP address of the anomalous node (if available in the graph).
  - **`recon_error`:** Reconstruction error for the node's features.

- **`edge_anomalies`:**  
  A list of detected anomalous edges, with details including:
  - **`source_node_id`:** Internal index of the source node of the anomalous edge.
  - **`target_node_id`:** Internal index of the target node of the anomalous edge.
  - **`source_ip`:** IP address of the source node (if available).
  - **`target_ip`:** IP address of the target node (if available).
  - **`recon_error`:** Reconstruction error for the edge's attributes (or adjacency).

### Embedding Visualizations (`embeddings/`)

If the `--visualize` flag is used  
(Note: this flag is not currently implemented in `main.py`, so this functionality may not be exposed via CLI yet),  
the script will periodically generate 2D **t-SNE embeddings** of the node features and save them as `.png` images.

These visualizations can help in:
- Understanding the latent space learned by the autoencoder.
- Potentially identifying clusters of normal and anomalous nodes.


### Logs (logs/)
General application logs, including information about data processing, model updates, and anomaly detection progress, are written to files in the directory specified by --log_path or printed to the console if --log_path is not provided.
## Further Development

The following are planned next steps for this project:

* **Update Visualize function:** (Noted in this file)
* **Further investigate embeddings (when normal dataset is available):** Analyze the latent space learned by the autoencoder on a dedicated "normal" dataset to better understand normal patterns and improve anomaly discrimination.
* **Adjust feature engineering:** Refine the selection and processing of input features to the GNN to ensure only the most relevant information is used.
* **Think about feature standardization/normalization:** Ensure proper scaling of input features for stable and effective model training.

## License

TO DECIDE