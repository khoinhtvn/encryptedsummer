2025-06-03 15:09:46,205 - INFO - Application logging to file: logs/app_20250603_150946.log
2025-06-03 15:09:46,205 - INFO - Starting to monitor directory: /home/lu/Desktop/output/ with log level: DEBUG
2025-06-03 15:09:46,205 - INFO - Starting to monitor directory: /home/lu/Desktop/output/ for new files every 30 seconds.
2025-06-03 15:09:46,205 - INFO - Train Mode: train, Visualization Path: vis
2025-06-03 15:09:46,205 - INFO - Initially found and marked as processed: nw_graph_encoded_1748955880.dot
2025-06-03 15:09:46,205 - INFO - Initially found and marked as processed: nw_graph_encoded_1748955865.dot
2025-06-03 15:09:46,205 - INFO - Initially found and marked as processed: nw_graph_encoded_1748956015.dot
2025-06-03 15:09:46,205 - INFO - Initially found and marked as processed: nw_graph_encoded_1748956060.dot
2025-06-03 15:09:46,205 - INFO - Initially found and marked as processed: nw_graph_encoded_1748956120.dot
2025-06-03 15:09:46,205 - INFO - Initially found and marked as processed: nw_graph_encoded_1748956150.dot
2025-06-03 15:09:46,205 - INFO - Initially found and marked as processed: nw_graph_encoded_1748956030.dot
2025-06-03 15:09:46,206 - INFO - Initially found and marked as processed: nw_graph_encoded_1748956180.dot
2025-06-03 15:09:46,206 - INFO - Initially found and marked as processed: nw_graph_encoded_1748955910.dot
2025-06-03 15:09:46,206 - INFO - Initially found and marked as processed: nw_graph_encoded_1748956165.dot
2025-06-03 15:09:46,206 - INFO - Initially found and marked as processed: nw_graph_encoded_1748955895.dot
2025-06-03 15:09:46,206 - INFO - Initially found and marked as processed: nw_graph_encoded_1748955850.dot
2025-06-03 15:09:46,206 - INFO - Initially found and marked as processed: nw_graph_encoded_1748956045.dot
2025-06-03 15:09:46,206 - INFO - Initially found and marked as processed: nw_graph_encoded_1748955955.dot
2025-06-03 15:09:46,206 - INFO - Initially found and marked as processed: nw_graph_encoded_1748956000.dot
2025-06-03 15:09:46,206 - INFO - Initially found and marked as processed: nw_graph_encoded_1748955970.dot
2025-06-03 15:09:46,206 - INFO - Initially found and marked as processed: nw_graph_encoded_1748956090.dot
2025-06-03 15:09:46,206 - INFO - Initially found and marked as processed: nw_graph_encoded_1748955985.dot
2025-06-03 15:09:46,206 - INFO - Initially found and marked as processed: nw_graph_encoded_1748956105.dot
2025-06-03 15:09:46,206 - INFO - Initially found and marked as processed: nw_graph_encoded_1748955940.dot
2025-06-03 15:09:46,206 - INFO - Initially found and marked as processed: nw_graph_encoded_1748956075.dot
2025-06-03 15:09:46,206 - INFO - Initially found and marked as processed: nw_graph_encoded_1748955925.dot
2025-06-03 15:09:46,206 - INFO - Initially found and marked as processed: nw_graph_encoded_1748956135.dot
2025-06-03 15:09:46,206 - INFO - Initial scan complete. 23 existing files found.
2025-06-03 15:09:55,247 - INFO - Found 1 new .dot files.
2025-06-03 15:09:55,247 - INFO - 
--- Processing new file: nw_graph_encoded_1748956195.dot ---
2025-06-03 15:09:55,247 - INFO - Processing update from: /home/lu/Desktop/output/nw_graph_encoded_1748956195.dot
2025-06-03 15:09:55,247 - INFO - Processing /home/lu/Desktop/output/nw_graph_encoded_1748956195.dot file.
2025-06-03 15:09:55,247 - INFO - Parsed 0 nodes.
2025-06-03 15:09:55,247 - INFO - Parsed 0 edges.
2025-06-03 15:09:55,247 - INFO - Starting NetworkX to PyG conversion.
2025-06-03 15:09:55,247 - DEBUG - Sorted node attribute keys: ['outgoing_ratio', 'incoming_ratio', 'server_score', 'client_score', 'unique_protocols', 'protocol_entropy', 'most_freq_proto_ratio', 'unique_remote_ports', 'unique_local_ports', 'remote_port_diversity', 'local_port_diversity', 'privileged_remote_ratio', 'privileged_local_ratio', 'first_seen_hour_minute_sin', 'first_seen_hour_minute_cos', 'last_seen_hour_minute_sin', 'last_seen_hour_minute_cos', 'http_ratio', 'ssl_ratio']
2025-06-03 15:09:55,247 - DEBUG - Initial node features tensor shape: torch.Size([0, 19])
2025-06-03 15:09:55,248 - WARNING - Skipping standard scaling for node features: No features to scale.
2025-06-03 15:09:55,248 - DEBUG - Node features tensor shape after scaling: torch.Size([0, 19])
2025-06-03 15:09:55,248 - DEBUG - Edge index tensor shape: torch.Size([2, 0])
2025-06-03 15:09:55,248 - DEBUG - Sorted edge attribute keys: ['dst_port', 'count', 'total_orig_bytes', 'total_resp_bytes', 'total_orig_pkts', 'total_resp_pkts', 'total_orig_ip_bytes', 'total_resp_ip_bytes', 'protocol', 'service']
2025-06-03 15:09:55,248 - INFO - No edge attributes (numerical or categorical) found.
2025-06-03 15:09:55,248 - INFO - Successfully converted NetworkX graph to PyG Data object.
2025-06-03 15:09:55,248 - INFO - Initializing HybridGNNAnomalyDetector with node_dim=19, edge_dim=0, hidden_dim=128, embedding_dim=64, heads=4, num_gat_layers=3, gat_heads=4, recon_loss_type=mse, edge_recon_loss_type=bce
2025-06-03 15:09:55,248 - INFO - Initializing GraphAutoencoder with node_dim=19, edge_dim=0, hidden_dim=128, embedding_dim=64, num_gat_layers=3, gat_heads=4, use_batch_norm=True, use_residual=True
2025-06-03 15:09:55,285 - DEBUG - Encoder GATConv layers initialized with final embedding dimension: 64
2025-06-03 15:09:55,287 - DEBUG - Decoder MLP layers initialized with proper weight initialization.
2025-06-03 15:09:55,288 - DEBUG - Anomaly scoring MLPs initialized.
2025-06-03 15:09:55,289 - INFO - Optimizer (AdamW) and scheduler (CosineAnnealingWarmRestarts) initialized.
2025-06-03 15:09:55,289 - INFO - Replay buffer initialized with maxlen=2000, batch_size=16
2025-06-03 15:09:55,289 - INFO - RunningStats initialized.
2025-06-03 15:09:55,289 - INFO - RunningStats initialized.
2025-06-03 15:09:55,289 - INFO - Statistical controls initialized: drift_threshold=0.15
2025-06-03 15:09:55,289 - INFO - Using device: cpu
2025-06-03 15:09:55,290 - INFO - Initialized Hybrid GNN (node_dim=19, edge_dim=0)
2025-06-03 15:09:55,311 - INFO - Checkpoint loaded from model_checkpoints/latest_checkpoint.pth at epoch 1
2025-06-03 15:09:55,312 - INFO - Resuming online updates from step: 1
2025-06-03 15:09:55,312 - INFO - Running statistics loaded from stats/running_stats.pkl
2025-06-03 15:09:55,312 - INFO - Performing online update...
2025-06-03 15:09:55,312 - INFO - Starting online update for 50 steps.
2025-06-03 15:09:55,312 - DEBUG - Calculated standard deviation: [1.00000002 1.00000001 1.         1.         1.         0.99999999
 1.         1.         0.99999999 1.         1.         0.99999999
 0.99999998 0.99545771 0.99545772 0.99545772 0.99545772 1.
 1.00000002]
2025-06-03 15:09:55,312 - DEBUG - Calculated standard deviation: [0.50539635 2.0879168  1.         1.00000001 1.00000001 1.
 1.         1.         1.         1.         0.99999999 1.00000001
 1.         1.         1.00000001 0.99999999 0.99999999 0.99999999
 0.99999999 0.99999999 0.99999999 1.        ]
2025-06-03 15:09:55,312 - DEBUG - Adding data to replay buffer. Has edge_index: True
2025-06-03 15:09:55,312 - DEBUG - Online update step: 1/50
2025-06-03 15:09:55,312 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,312 - DEBUG - Online update step: 2/50
2025-06-03 15:09:55,313 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,313 - DEBUG - Online update step: 3/50
2025-06-03 15:09:55,313 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,313 - DEBUG - Online update step: 4/50
2025-06-03 15:09:55,313 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,313 - DEBUG - Online update step: 5/50
2025-06-03 15:09:55,313 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,313 - DEBUG - Online update step: 6/50
2025-06-03 15:09:55,313 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,313 - DEBUG - Online update step: 7/50
2025-06-03 15:09:55,313 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,313 - DEBUG - Online update step: 8/50
2025-06-03 15:09:55,313 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,313 - DEBUG - Online update step: 9/50
2025-06-03 15:09:55,313 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,313 - DEBUG - Online update step: 10/50
2025-06-03 15:09:55,313 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,313 - DEBUG - Online update step: 11/50
2025-06-03 15:09:55,313 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,313 - DEBUG - Online update step: 12/50
2025-06-03 15:09:55,313 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,313 - DEBUG - Online update step: 13/50
2025-06-03 15:09:55,313 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,313 - DEBUG - Online update step: 14/50
2025-06-03 15:09:55,313 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,313 - DEBUG - Online update step: 15/50
2025-06-03 15:09:55,313 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,313 - DEBUG - Online update step: 16/50
2025-06-03 15:09:55,313 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,313 - DEBUG - Online update step: 17/50
2025-06-03 15:09:55,313 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,313 - DEBUG - Online update step: 18/50
2025-06-03 15:09:55,313 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,313 - DEBUG - Online update step: 19/50
2025-06-03 15:09:55,313 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,313 - DEBUG - Online update step: 20/50
2025-06-03 15:09:55,313 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,313 - DEBUG - Online update step: 21/50
2025-06-03 15:09:55,313 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,313 - DEBUG - Online update step: 22/50
2025-06-03 15:09:55,313 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,313 - DEBUG - Online update step: 23/50
2025-06-03 15:09:55,313 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,313 - DEBUG - Online update step: 24/50
2025-06-03 15:09:55,314 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,314 - DEBUG - Online update step: 25/50
2025-06-03 15:09:55,314 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,314 - DEBUG - Online update step: 26/50
2025-06-03 15:09:55,314 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,314 - DEBUG - Online update step: 27/50
2025-06-03 15:09:55,314 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,314 - DEBUG - Online update step: 28/50
2025-06-03 15:09:55,314 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,314 - DEBUG - Online update step: 29/50
2025-06-03 15:09:55,314 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,314 - DEBUG - Online update step: 30/50
2025-06-03 15:09:55,314 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,314 - DEBUG - Online update step: 31/50
2025-06-03 15:09:55,314 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,314 - DEBUG - Online update step: 32/50
2025-06-03 15:09:55,314 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,314 - DEBUG - Online update step: 33/50
2025-06-03 15:09:55,314 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,314 - DEBUG - Online update step: 34/50
2025-06-03 15:09:55,314 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,314 - DEBUG - Online update step: 35/50
2025-06-03 15:09:55,314 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,314 - DEBUG - Online update step: 36/50
2025-06-03 15:09:55,314 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,314 - DEBUG - Online update step: 37/50
2025-06-03 15:09:55,314 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,314 - DEBUG - Online update step: 38/50
2025-06-03 15:09:55,314 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,314 - DEBUG - Online update step: 39/50
2025-06-03 15:09:55,314 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,314 - DEBUG - Online update step: 40/50
2025-06-03 15:09:55,314 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,314 - DEBUG - Online update step: 41/50
2025-06-03 15:09:55,314 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,314 - DEBUG - Online update step: 42/50
2025-06-03 15:09:55,314 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,314 - DEBUG - Online update step: 43/50
2025-06-03 15:09:55,314 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,314 - DEBUG - Online update step: 44/50
2025-06-03 15:09:55,314 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,314 - DEBUG - Online update step: 45/50
2025-06-03 15:09:55,314 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,314 - DEBUG - Online update step: 46/50
2025-06-03 15:09:55,314 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,315 - DEBUG - Online update step: 47/50
2025-06-03 15:09:55,315 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,315 - DEBUG - Online update step: 48/50
2025-06-03 15:09:55,315 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,315 - DEBUG - Online update step: 49/50
2025-06-03 15:09:55,315 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,315 - DEBUG - Online update step: 50/50
2025-06-03 15:09:55,315 - WARNING - Not enough data in replay buffer for a full batch. Skipping this step.
2025-06-03 15:09:55,315 - WARNING - No successful steps during online update.
2025-06-03 15:09:55,315 - WARNING - Skipping drift detection: Node or edge features are None.
2025-06-03 15:09:55,315 - INFO - Online update complete. Loss: 0.0000
2025-06-03 15:09:55,315 - INFO - Running anomaly detection...
2025-06-03 15:09:55,315 - INFO - Running statistics saved to stats/running_stats.pkl
2025-06-03 15:09:55,321 - INFO - Checkpoint saved to model_checkpoints/checkpoint_20250603_150955_update_1.pth and as latest_checkpoint.pth
2025-06-03 15:09:55,322 - INFO - Starting 3D embedding visualization...
2025-06-03 15:09:55,323 - ERROR - Error during 3D t-SNE or plotting: perplexity must be less than n_samples
2025-06-03 15:09:55,324 - ERROR - Traceback (most recent call last):
  File "/home/lu/Documents/graph_anomaly_detection/graph_monitor/workflow_test.py", line 310, in visualize_embeddings_3d
    reduced_embeddings = tsne.fit_transform(embeddings)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lu/Documents/graph_anomaly_detection/graph_monitor/.venv/lib/python3.12/site-packages/sklearn/utils/_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lu/Documents/graph_anomaly_detection/graph_monitor/.venv/lib/python3.12/site-packages/sklearn/base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lu/Documents/graph_anomaly_detection/graph_monitor/.venv/lib/python3.12/site-packages/sklearn/manifold/_t_sne.py", line 1177, in fit_transform
    self._check_params_vs_input(X)
  File "/home/lu/Documents/graph_anomaly_detection/graph_monitor/.venv/lib/python3.12/site-packages/sklearn/manifold/_t_sne.py", line 862, in _check_params_vs_input
    raise ValueError("perplexity must be less than n_samples")
ValueError: perplexity must be less than n_samples

2025-06-03 15:09:55,324 - WARNING - Skipping edge feature visualization: No edge features available.
2025-06-03 15:09:55,324 - INFO - Directory /home/lu/Desktop/output/ does not exist. Waiting for 30 seconds...
2025-06-03 15:09:55,324 - INFO - No new .dot files found in /home/lu/Desktop/output/. Waiting for 30 seconds...
